#!/bin/bash
cd /root/code/apollo-jiangsu-crm-v1.3
echo "Now updating the files from svn server!"
svn update
echo "SVN update has done!"
websitename=Global
#read -p "Please enter the name of the website you will deploy which are Australia,Brazil,Canada,France,Germany,Global,India,Indonesia,Italy,Japan,Mexico,Panama,Russia,Spain,Thailand,Turkey,UAE,UK,United States : " websitename
export websitename
#read -p "Please enter the server's ipaddress where you will deploy the project in: " ip
ip=172.*.*.*
#sh /root/b2bdeploy_js/Initialization.sh
echo "The environment has initialized successfully!"
sed -i "s/^website.*$/website=$websitename/g" /root/code/apollo-jiangsu-crm-v1.1/apollo-jiangsu-portal/src/main/resources/blacklist.properties
sed -i "s/^website.*$/website=$websitename/g" /root/code/apollo-jiangsu-crm-v1.1/apollo-jiangsu-portal/src/main/resources/baseServer.properties
sed -i "s#/apollo-b2b-portal.*/#/apollo-b2b-portal-$websitename/#g" /root/code/apollo-jiangsu-crm-v1.1/apollo-jiangsu-portal/src/main/resources/blacklist.properties
#sed -i "s/title.*$/title=RENESOLA $websitename/g" /root/code/apollo-jiangsu-crm-v1.1/apollo-jiangsu-portal/src/main/resources/i18n.txt
echo "Now compile the project and package it!"
cd /root/code/apollo-jiangsu-crm-v1.1
mvn clean install
sleep 5
echo "mvn compile is completed!"
cd apollo-jiangsu-portal/target
mv apollo-jiangsu-portal.war apollo-b2b-portal-$websitename.war
scp -o StrictHostKeyChecking=no *.war  apollo@$ip:/home/apollo
sed  "s#apollo-b2b-portal-tem#apollo-b2b-portal-$websitename#g" /root/b2bdeploy_js/SetEnvWar.sh >/root/b2bdeploy_js/finalwardeploy.sh
ssh apollo@$ip "bash" < /root/b2bdeploy_js/finalwardeploy.sh
